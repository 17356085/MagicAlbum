# MagicAlbum 测试计划（初稿）

版本：v0.1 初稿  
状态：草案  
更新日期：2025-12-21

## 1. 目标与范围
- 目标：验证里程碑 1 的核心功能质量，确保分区列表（搜索/分页）、发帖与基础鉴权在目标环境稳定运行。
- 范围：前端（SPA）、后端（REST API）、数据库交互与基础安全。

## 2. 测试类型
- 单元测试：后端 Service/Repository；前端组件与工具函数。
- 集成测试：后端接口在内嵌容器中运行，验证数据库读写与鉴权。
- API 测试：覆盖主要 REST 接口（Auth/Sections/Threads）。
- E2E 测试：浏览器级场景（分区查询与分页、登录后发帖）。
- 性能测试：分页查询与发帖的 P95 响应时间与资源占用。
- 安全测试：弱口令、JWT 伪造、基础 XSS/注入。

## 3. 环境与工具
- 环境：Node ≥ 20.18；JDK ≥ 17；本地 DB 与 Docker Compose。
- 工具：
  - 前端：Vitest/Jest（单元）、Playwright/Cypress（E2E）。
  - 后端：JUnit + Spring Test（集成）、Postman/Newman（API）。
  - 性能：k6/JMeter（API 级性能）。

## 4. 测试数据
- 分区示例：摄影/绘画/旅行；生成 50+ 帖子样本以验证分页。
- 用户示例：`user1/user2` 普通用户；`admin` 管理员。

## 5. 测试用例纲要（示例）
- TC-SEC-01：分区列表默认分页，返回 20 条且可下一页。
- TC-SEC-02：关键字搜索 `q=摄影`，仅返回匹配分区。
- TC-SEC-03：切换 `size=50`，总页数计算正确。
- TC-AUTH-01：注册后可登录并获取 `accessToken`。
- TC-TH-01：登录后发帖成功（必填校验正确）。
- TC-TH-02：未登录发帖返回 401/403。
- TC-TH-03：发帖内容过长或空值时报 400，并给出 `message`。

## 6. 缺陷管理与退出准则
- 缺陷等级：Critical/High/Medium/Low；统一跟踪与回归验证。
- 退出准则：
  - 关键路径用例通过率 ≥ 95%。
  - P95 性能指标达标；无阻断性安全问题。

## 7. 里程碑与分工
- 里程碑 1：完成上述用例与报告；核心功能达成。
- 分工建议：后端负责 Auth/Sections/Threads API 与集成测试；前端负责页面交互与 E2E；QA 汇总报告。

---

## 8. 质量门槛与覆盖率指标（新增）
- 覆盖率目标：
  - 后端：行覆盖率 ≥ 70%，分支覆盖率 ≥ 60%（核心模块 ≥ 80%）。
  - 前端：组件/工具函数单测覆盖率 ≥ 60%，关键交互 E2E 用例通过率 ≥ 95%。
- 性能门槛：
  - 分区列表 P95 响应时间 ≤ 200ms，P99 ≤ 300ms；
  - 发帖接口 P95 ≤ 500ms。
- 安全门槛：
  - 弱口令用例全部命中；
  - JWT 伪造/过期/无效场景均被拒绝；
  - 基础 XSS/SQL 注入用例无通过。

## 9. 报告输出与追踪（新增）
- 测试报告：每次回归输出 HTML/Markdown 报告，包含通过率、失败用例与缺陷链接。
- 缺陷追踪：以 `Critical/High/Medium/Low` 记录并附带复现步骤与修复版本；回归时强制引用缺陷ID。
- 指标采集：将关键接口的响应时间、错误率上报至监控（可选），在报告中纳入图表。

## 10. 相关文档（新增）
- `API/API规范.md` 接口契约与错误码约定
- `实施与配置/环境配置.md` 测试环境搭建与切换
- `技术迁移/从SpringDataJPA迁移到MyBatis-Plus.md` 迁移阶段的验收标准