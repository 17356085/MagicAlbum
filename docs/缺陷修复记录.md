# 缺陷修复记录

更新时间：2025-12-27

## 2025-12-27

- 我的评论页面显示不直观（仅显示所属帖子编号）
  - 现象：`MyPosts.vue` 中“所属帖子：#<threadId>` 不易辨认。
  - 处理：后端 `PostDto` 新增 `threadTitle` 字段并在 `PostService.toDto` 中填充；前端优先显示 `threadTitle`，缺失时回退为 `#threadId`。

- 从“我的评论”跳转无法定位具体评论
  - 现象：跳转到帖子详情后，页面未自动滚动到目标评论。
  - 处理：统一锚点约定 `/threads/{threadId}#post-{postId}`；`ThreadDetail.vue` 解析 `route.hash` 并传递到 `Comments.vue` 的 `scrollToPostId`；`Comments.vue` 展开包含目标的楼层、切换分页并平滑滚动到视图中心。

- 登出后页面仍残留登录态数据
  - 现象：登出后部分页面仍显示登录时的数据或用户信息。
  - 处理：`useAuth.logout()` 清理本地存储并强制刷新；同时在“设置/我的帖子/我的评论”页面登出时先重定向到“发现”页，再执行登出与刷新，确保退出后停留在公共页面。

- 登录后未及时更新全站状态
  - 现象：登录成功后，部分页面仍按未登录状态显示。
  - 处理：`useAuth.loginWithPhonePassword / loginWithEmailPassword` 成功后立即触发强制刷新，确保全站重新初始化。

## 已知问题与建议

- 评论定位的高亮样式需统一；在极长楼层分页中，定位后可能需要额外提示。
- 强制刷新会造成轻微闪烁，后续可考虑改为软刷新（清空相关状态 + 重新拉取数据），并按页面粒度优化。