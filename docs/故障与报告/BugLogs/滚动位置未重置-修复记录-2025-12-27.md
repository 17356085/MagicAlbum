# 滚动位置未重置（Discover → ThreadDetail）

日期：2025-12-27

## 现象
- 在“发现”页向下滚动后，点击某个帖子进入“帖子详情”页时，详情页的滚动位置仍停留在“发现”页的滚动高度处，没有回到页面顶部。
- 浏览器返回到“发现”页时，滚动位置保持在先前的位置（这一点是正确的期望）。

## 影响范围
- 前端页面：`Discover.vue` → `ThreadDetail.vue` 的普通路由跳转。
- 所有没有显式控制滚动的页面间导航均可能受影响。

## 复现步骤
1. 打开“发现”页 `/discover`。
2. 向下滚动数屏。
3. 点击任一帖子进入“帖子详情” `/threads/:id`。
4. 可见详情页初始并非在顶部，而是继承了之前的滚动位置。

## 根因分析
- Vue Router 在未配置 `scrollBehavior` 时的默认行为：
  - 浏览器“返回/前进”（`popstate`）会恢复历史滚动位置（`savedPosition`）。
  - 普通导航不会重置滚动位置，页面将保留当前窗口的滚动状态。
- 本项目未对路由滚动进行统一配置，导致从列表页跳转详情页时没有滚到顶部。

## 修复方案
- 在路由配置中添加 `scrollBehavior`，明确约定导航后的滚动行为：
  - 若存在 `savedPosition`（返回/前进），使用该位置以保留历史体验。
  - 若目标包含哈希（如 `#post-123`），滚动至对应元素（平滑滚动）。
  - 其他普通导航场景统一滚动到顶部（`{ top: 0 }`）。

### 代码改动
文件：`front/src/router/index.js`

```js
const router = createRouter({
  history: createWebHistory(),
  routes,
  scrollBehavior(to, from, savedPosition) {
    if (savedPosition) return savedPosition
    if (to.hash) return { el: to.hash, behavior: 'smooth' }
    return { top: 0 }
  },
})
```

## 验证
- Discover → ThreadDetail：进入详情页时滚动复位到顶部。
- 浏览器返回到 Discover：滚动位置恢复为离开时位置。
- ThreadDetail 带哈希锚点（如评论链接 `#post-123`）：进入后定位到目标元素。

## 风险与兼容性
- 若少数页面希望在普通导航也保留滚动位置，可为该路由设置元信息并在 `scrollBehavior` 中做例外处理，例如：
  - 在路由 `meta: { preserveScroll: true }`，并在 `scrollBehavior` 中检测 `to.meta.preserveScroll` 时返回 `false` 或当前滚动。
- 现有改动遵循常见产品体验，默认风险低。

## 相关改进
- 为减少视觉干扰，已移除左侧栏容器的内部滚动条（`App.vue` 中删除 `lg:max-h[...]` 与 `lg:overflow-y-auto`），由页面整体滚动负责内容浏览。

## 结论
- 问题根因是未配置路由滚动策略，导致普通导航不复位滚动。
- 通过添加 `scrollBehavior` 已修复，验证通过，体验与预期一致。