# 故障报告：编译失败 - 符号缺失与类名冲突

**日期**: 2025-12-29
**状态**: 已修复
**模块**: end (后端)

## 1. 问题描述
在执行 `mvn clean install` 时，项目构建失败，报告了多个编译错误。主要包括：
1.  `AiController.java` 和 `ThreadSummaryListener.java` 中找不到 `Thread` 实体的 `getSummary`、`setSummary` 等方法。
2.  `ThreadService.java` 中找不到 `RabbitTemplate` 符号。
3.  `AiController.java` 中 `Thread.sleep` 方法调用与导入的实体类 `Thread` 发生名称冲突。

## 2. 错误详情
### 2.1 实体类字段缺失
```text
[ERROR] /.../AiController.java:[37,29] 找不到符号
  符号:   方法 getSummary()
  位置: 类型为com.example.demo.threads.entity.Thread的变量 thread
...
[ERROR] /.../Thread.java:[51,13] 找不到符号
  符号:   变量 summaryStatus
  位置: 类 com.example.demo.threads.entity.Thread
```

### 2.2 服务类依赖缺失
```text
[ERROR] /.../ThreadService.java:[60,13] 找不到符号
  符号:   变量 rabbitTemplate
  位置: 类 com.example.demo.threads.service.ThreadService
```

### 2.3 类名冲突
```text
[ERROR] /.../AiController.java:[81,33] 找不到符号
  符号:   方法 sleep(int)
  位置: 类 com.example.demo.threads.entity.Thread
```
由于 `AiController` 导入了 `com.example.demo.threads.entity.Thread`，导致代码中直接使用 `Thread.sleep()` 时被误认为是调用实体类的静态方法，而非 `java.lang.Thread`。

## 3. 根本原因
1.  **代码未同步**: `Thread` 实体类中缺少了 AI 摘要功能所需的 `summary` 和 `summaryStatus` 字段及其 Getter/Setter 方法。
2.  **依赖注入缺失**: `ThreadService` 中使用了 `RabbitTemplate` 发送消息，但未在构造函数中注入该依赖，也未导入相关类。
3.  **命名冲突**: 实体类命名为 `Thread`，与 Java 核心类 `java.lang.Thread` 重名，在同一文件中混用时未加区分。

## 4. 解决方案

### 4.1 补全 `Thread` 实体类
在 `src/main/java/com/example/demo/threads/entity/Thread.java` 中添加缺失字段和方法：
```java
    @Column(name = "summary", columnDefinition = "TEXT")
    private String summary;

    @Column(name = "summary_status", length = 32)
    private String summaryStatus = "PENDING";

    // ... Getter and Setter methods ...
    
    @PrePersist
    public void prePersist() {
        // ... existing code ...
        if (summaryStatus == null) summaryStatus = "PENDING";
    }
```

### 4.2 修正 `ThreadService`
在 `src/main/java/com/example/demo/threads/service/ThreadService.java` 中：
1.  导入 `org.springframework.amqp.rabbit.core.RabbitTemplate`。
2.  在构造函数中注入 `RabbitTemplate`。

```java
    private final RabbitTemplate rabbitTemplate;

    public ThreadService(..., RabbitTemplate rabbitTemplate) {
        // ...
        this.rabbitTemplate = rabbitTemplate;
    }
```

### 4.3 解决 `AiController` 冲突
在 `src/main/java/com/example/demo/ai/controller/AiController.java` 中，使用全限定名调用 `sleep` 方法：

```java
try { 
    java.lang.Thread.sleep(50); 
} catch (InterruptedException ignored) {}
```

## 5. 验证结果
执行 `mvn clean install -DskipTests`，构建成功。

```text
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
```
